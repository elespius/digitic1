= form_tag "/", :method => :get do
  - @current_community.custom_dropdown_fields.sort.each do |field|
    .row
      .col-12
        .custom-filter-title
          = field.name(I18n.locale)
        - make_scrollable = field.options.size > 10
        .custom-filter-options{:class => make_scrollable ? "scrollable" : ""}
          - field.options.sort.each do |option|
            .custom-filter-checkbox-container
              %label.custom-filter-checkbox-label
                = check_box_tag "filter_option_#{option.id}", "#{option.id}", params["filter_option_#{option.id}"]
                %span.custom-filter-checkbox-label-text
                  = option.title(I18n.locale)
  - params.except("action", "controller").each do |param, value|
    - unless param.match(/^filter_option/)
      = hidden_field_tag param, value

  - @current_community.custom_numeric_fields.sort.each do |field|
    .row
      .col-12
        .custom-filter-title
          = field.name(I18n.locale)
    - id = [field.id, device].join("-")
    .row
      .col-12
        .custom-filter-options
          .range-slider{id: "range-slider-#{id}"}
          - content_for :extra_javascript do
            :javascript
              function updateMin(el) {
                return function(val) {
                  el.html(val);
                }
              }

              function updateMax(el) {
                return function(val) {
                  el.html(val);
                }
              }

              $("#range-slider-#{id}").noUiSlider({
                range: [#{field.min}, #{field.max}]
                ,step: #{field.allow_decimals ? 0.01 : 1}
                ,start: [#{params["numeric_filter_min_" + field.id.to_s] || field.min}, #{params["numeric_filter_max_" + field.id.to_s] || field.max}]
                ,connect: true
                ,serialization: {
                  resolution: #{field.allow_decimals ? 0.01 : 1}
                  ,to: [
                    [$("#numeric_filter_min_#{id}"), updateMin($("#custom-filter-min-value-#{id}"))],
                    [$("#numeric_filter_max_#{id}"), updateMax($("#custom-filter-max-value-#{id}"))]
                  ]
                }
              });
    .row
      .col-12
        .left
          %span.custom-filter-min-max-title
            Min:
          %span{id: "custom-filter-min-value-#{id}"}
          %input{type: "hidden", id: "numeric_filter_min_#{id}", name: "numeric_filter_min_#{field.id}", value: params["numeric_filter_min_#{field.id}"]}
        .right
          %span.custom-filter-min-max-title
            Max:
          %span{id: "custom-filter-max-value-#{id}"}
          %input{type: "hidden", id: "numeric_filter_max_#{id}", name: "numeric_filter_max_#{field.id}", value: params["numeric_filter_max_#{field.id}"]}


  %button{type: 'submit'}
    = t(".update_view")